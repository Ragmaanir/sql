<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.27.2">


<link href="css/style.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="js/doc.js"></script>
<script type="text/javascript">
  CrystalDoc.base_path = "";
</script>

  <meta id="repository-name" content="github.com/onyxframework/sql">
  <title>README - github.com/onyxframework/sql</title>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="repository-links">
      <a href="index.html">README</a>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="github.com/onyxframework/sql/Onyx" data-name="onyx">
      <a href="Onyx.html">Onyx</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/onyxframework/sql/Onyx/SQL" data-name="onyx::sql">
      <a href="Onyx/SQL.html">SQL</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters" data-name="onyx::sql::converters">
      <a href="Onyx/SQL/Converters.html">Converters</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/PG" data-name="onyx::sql::converters::pg">
      <a href="Onyx/SQL/Converters/PG.html">PG</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/PG/Any" data-name="onyx::sql::converters::pg::any(t)">
      <a href="Onyx/SQL/Converters/PG/Any.html">Any</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/PG/Enum" data-name="onyx::sql::converters::pg::enum(t)">
      <a href="Onyx/SQL/Converters/PG/Enum.html">Enum</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/PG/JSON" data-name="onyx::sql::converters::pg::json(t)">
      <a href="Onyx/SQL/Converters/PG/JSON.html">JSON</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/PG/UUID" data-name="onyx::sql::converters::pg::uuid">
      <a href="Onyx/SQL/Converters/PG/UUID.html">UUID</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/SQLite3" data-name="onyx::sql::converters::sqlite3">
      <a href="Onyx/SQL/Converters/SQLite3.html">SQLite3</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/SQLite3/Any" data-name="onyx::sql::converters::sqlite3::any(t)">
      <a href="Onyx/SQL/Converters/SQLite3/Any.html">Any</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/SQLite3/EnumInt" data-name="onyx::sql::converters::sqlite3::enumint(t)">
      <a href="Onyx/SQL/Converters/SQLite3/EnumInt.html">EnumInt</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/SQLite3/EnumText" data-name="onyx::sql::converters::sqlite3::enumtext(t)">
      <a href="Onyx/SQL/Converters/SQLite3/EnumText.html">EnumText</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/SQLite3/JSON" data-name="onyx::sql::converters::sqlite3::json(t)">
      <a href="Onyx/SQL/Converters/SQLite3/JSON.html">JSON</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/SQLite3/UUIDBlob" data-name="onyx::sql::converters::sqlite3::uuidblob">
      <a href="Onyx/SQL/Converters/SQLite3/UUIDBlob.html">UUIDBlob</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Converters/SQLite3/UUIDText" data-name="onyx::sql::converters::sqlite3::uuidtext">
      <a href="Onyx/SQL/Converters/SQLite3/UUIDText.html">UUIDText</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Field" data-name="onyx::sql::field">
      <a href="Onyx/SQL/Field.html">Field</a>
      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/sql/Onyx/SQL/Model" data-name="onyx::sql::model">
      <a href="Onyx/SQL/Model.html">Model</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/onyxframework/sql/Onyx/SQL/Model/Changeset" data-name="onyx::sql::model::changeset(t, u)">
      <a href="Onyx/SQL/Model/Changeset.html">Changeset</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Model/Changeset/NoChanges" data-name="onyx::sql::model::changeset::nochanges">
      <a href="Onyx/SQL/Model/Changeset/NoChanges.html">NoChanges</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Model/ClassQueryShortcuts" data-name="onyx::sql::model::classqueryshortcuts(t)">
      <a href="Onyx/SQL/Model/ClassQueryShortcuts.html">ClassQueryShortcuts</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Model/Mappable" data-name="onyx::sql::model::mappable(t)">
      <a href="Onyx/SQL/Model/Mappable.html">Mappable</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Model/Options" data-name="onyx::sql::model::options">
      <a href="Onyx/SQL/Model/Options.html">Options</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/sql/Onyx/SQL/Query" data-name="onyx::sql::query(t)">
      <a href="Onyx/SQL/Query.html">Query</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Query/JoinType" data-name="onyx::sql::query::jointype">
      <a href="Onyx/SQL/Query/JoinType.html">JoinType</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Query/Order" data-name="onyx::sql::query::order">
      <a href="Onyx/SQL/Query/Order.html">Order</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Query/Type" data-name="onyx::sql::query::type">
      <a href="Onyx/SQL/Query/Type.html">Type</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Reference" data-name="onyx::sql::reference">
      <a href="Onyx/SQL/Reference.html">Reference</a>
      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/sql/Onyx/SQL/Repository" data-name="onyx::sql::repository">
      <a href="Onyx/SQL/Repository.html">Repository</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/onyxframework/sql/Onyx/SQL/Repository/Logger" data-name="onyx::sql::repository::logger">
      <a href="Onyx/SQL/Repository/Logger.html">Logger</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Repository/Logger/Dummy" data-name="onyx::sql::repository::logger::dummy">
      <a href="Onyx/SQL/Repository/Logger/Dummy.html">Dummy</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Repository/Logger/IO" data-name="onyx::sql::repository::logger::io">
      <a href="Onyx/SQL/Repository/Logger/IO.html">IO</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Repository/Logger/Standard" data-name="onyx::sql::repository::logger::standard">
      <a href="Onyx/SQL/Repository/Logger/Standard.html">Standard</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/sql/Onyx/SQL/Serializable" data-name="onyx::sql::serializable">
      <a href="Onyx/SQL/Serializable.html">Serializable</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<p>&lt;a href="https://onyxframework.org">&lt;img width="100" height="100" src="https://onyxframework.org/img/logo.svg">&lt;/a></p>

<h1>Onyx::SQL</h1>

<p><a href="https://crystal-lang.org/" target="_blank"><img src="https://img.shields.io/badge/built%20with-crystal-000000.svg?style=flat-square" alt="Built with Crystal"/></a>
<a href="https://travis-ci.org/onyxframework/sql" target="_blank"><img src="https://img.shields.io/travis/onyxframework/sql/stable.svg?style=flat-square" alt="Travis CI build"/></a>
<a href="https://docs.onyxframework.org/sql" target="_blank"><img src="https://img.shields.io/badge/docs-online-brightgreen.svg?style=flat-square" alt="Docs"/></a>
<a href="https://api.onyxframework.org/sql" target="_blank"><img src="https://img.shields.io/badge/api_docs-online-brightgreen.svg?style=flat-square" alt="API docs"/></a>
<a href="https://github.com/onyxframework/sql/releases" target="_blank"><img src="https://img.shields.io/github/release/onyxframework/sql.svg?style=flat-square" alt="Latest release"/></a></p>

<p>A deligtful SQL ORM.</p>

<h2>About 👋</h2>

<p>Onyx::SQL is a deligthful database-agnostic SQL ORM for <a href="https://crystal-lang.org/" target="_blank">Crystal language</a>. It features a convenient schema definition DSL, type-safe SQL query builder, clean architecture with Repository and more!</p>

<h2>Installation 📥</h2>

<p>Add these lines to your application's <code>shard.yml</code>:</p>

<pre><code class="language-yaml">dependencies:
  onyx:
    github: onyxframework/onyx
    version: ~> 0.3.0
  onyx-sql:
    github: onyxframework/sql
    version: ~> 0.7.0</code></pre>

<p>This shard follows <a href="http://semver.org/" target="_blank">Semantic Versioning v2.0.0</a>, so check <a href="https://github.com/onyxframework/rest/releases" target="_blank">releases</a> and change the <code>version</code> accordingly. Please visit <a href="https://github.com/crystal-lang/shards" target="_blank">github.com/crystal-lang/shards</a> to know more about Crystal shards.</p>

<p>You'd also need to add a database dependency conforming to the <a href="https://github.com/crystal-lang/crystal-db" target="_blank">crystal-db</a> interface. For example, <a href="https://github.com/will/crystal-pg" target="_blank">pg</a>:</p>

<pre><code class="language-diff">dependencies:
  onyx:
    github: onyxframework/onyx
    version: ~> 0.3.0
  onyx-sql:
    github: onyxframework/sql
    version: ~> 0.7.0
+ pg:
+   github: will/crystal-pg
+   version: ~> 0.15.0</code></pre>

<h2>Usage 💻</h2>

<p>For this PostgreSQL table:</p>

<pre><code class="language-sql">CREATE TABLE users (
  id          SERIAL      PRIMARY KEY,
  name        TEXT        NOT NULL
  created_at  TIMESTAMPTZ NOT NULL  DEFAULT now()
);</code></pre>

<p>Define the user schema:</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;onyx/sql&quot;</span>

<span class="k">class</span> <span class="t">User</span>
  <span class="k">include</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">SQL</span><span class="t">::</span><span class="t">Model</span>

  schema users <span class="k">do</span>
    pkey id : <span class="t">Int32</span>
    <span class="k">type</span> name : <span class="t">String</span>, not_null: <span class="n">true</span>
    <span class="k">type</span> created_at : <span class="t">Time</span>, not_null: <span class="n">true</span>, default: <span class="n">true</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>Insert a new user instance:</p>

<pre><code class="language-crystal">user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>(name: <span class="s">&quot;John&quot;</span>)
user <span class="o">=</span> <span class="t">Onyx</span>.query(user.insert.returning(<span class="s">&quot;*&quot;</span>)).first

pp user <span class="c"># =&gt; #&lt;User @id=1, @name=&quot;John&quot;, @created_at=#&lt;Time ...&gt;&gt;</span></code></pre>

<p>Query the user:</p>

<pre><code class="language-crystal">user <span class="o">=</span> <span class="t">Onyx</span>.query(<span class="t">User</span>.where(id: <span class="n">1</span>)).first?</code></pre>

<p>With another PostgreSQL table:</p>

<pre><code class="language-sql">CREATE TABLE posts (
  id          SERIAL      PRIMARY KEY,
  author_id   INT         NOT NULL  REFERENCES  users(id),
  content     TEXT        NOT NULL
  created_at  TIMESTAMPTZ NOT NULL  DEFAULT now()
);</code></pre>

<p>Define the post schema:</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">Post</span>
  <span class="k">include</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">SQL</span><span class="t">::</span><span class="t">Model</span>

  schema posts <span class="k">do</span>
    pkey id : <span class="t">Int32</span>
    <span class="k">type</span> author : <span class="t">User</span>, not_null: <span class="n">true</span>, key: <span class="s">&quot;author_id&quot;</span>
    <span class="k">type</span> content : <span class="t">String</span>, not_null: <span class="n">true</span>
    <span class="k">type</span> created_at : <span class="t">Time</span>, not_null: <span class="n">true</span>, default: <span class="n">true</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>Add the posts reference to the user schema:</p>

<pre><code class="language-diff">class User
  include Onyx::SQL::Model

  schema users do
    pkey id : Int32
    type name : String, not_null: true
    type created_at : Time, not_null: true, default: true
+   type authored_posts : Array(Post), foreign_key: "author_id"
  end
end</code></pre>

<p>Create a new post:</p>

<pre><code class="language-crystal">user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>(id: <span class="n">1</span>)
post <span class="o">=</span> <span class="t">Post</span>.<span class="k">new</span>(author: user, content: <span class="s">&quot;Hello, world!&quot;</span>)
<span class="t">Onyx</span>.exec(post.insert)</code></pre>

<p>Query all the posts by a user with name "John":</p>

<pre><code class="language-crystal">posts <span class="o">=</span> <span class="t">Onyx</span>.query(<span class="t">Post</span>
  .join(author: <span class="n">true</span>) <span class="k">do</span> <span class="o">|</span>x<span class="o">|</span>
    x.<span class="k">select</span>(<span class="n">:id</span>, <span class="n">:name</span>)
    x.where(name: <span class="s">&quot;John&quot;</span>)
  <span class="k">end</span>
)

posts.first <span class="c"># =&gt; #&lt;Post @id=1, @author=#&lt;User @id=1 @name=&quot;John&quot;&gt;, @content=&quot;Hello, world!&quot;&gt;</span></code></pre>

<h2>Documentation 📚</h2>

<p>The documentation is available online at <a href="https://docs.onyxframework.org/sql" target="_blank">docs.onyxframework.org/sql</a>.</p>

<h2>Community 🍪</h2>

<p>There are multiple places to talk about Onyx:</p>

<ul><li><a href="https://gitter.im/onyxframework" target="_blank">Gitter</a></li><li><a href="https://twitter.com/onyxframework" target="_blank">Twitter</a></li></ul>

<h2>Support 🕊</h2>

<p>This shard is maintained by me, <a href="https://vladfaust.com" target="_blank">Vlad Faust</a>, a passionate developer with years of programming and product experience. I love creating Open-Source and I want to be able to work full-time on Open-Source projects.</p>

<p>I will do my best to answer your questions in the free communication channels above, but if you want prioritized support, then please consider becoming my patron. Your issues will be labeled with your patronage status, and if you have a sponsor tier, then you and your team be able to communicate with me privately in <a href="https://twist.com" target="_blank">Twist</a>. There are other perks to consider, so please, don't hesistate to check my Patreon page:</p>

<p>&lt;a href="https://www.patreon.com/vladfaust">&lt;img height="50" src="https://onyxframework.org/img/patreon-button.svg">&lt;/a></p>

<p>You could also help me a lot if you leave a star to this GitHub repository and spread the word about Crystal and Onyx! 📣</p>

<h2>Contributing</h2>

<ol><li>Fork it ( https://github.com/onyxframework/sql/fork )</li><li>Create your feature branch (git checkout -b my-new-feature)</li><li>Commit your changes (git commit -am 'feat: some feature') using <a href="https://github.com/angular/angular/blob/master/CONTRIBUTING.md#commit" target="_blank">Angular style commits</a></li><li>Push to the branch (git push origin my-new-feature)</li><li>Create a new Pull Request</li></ol>

<h2>Contributors</h2>

<ul><li><a href="https://github.com/vladfaust" target="_blank">Vlad Faust</a> - creator and maintainer</li></ul>

<h2>Licensing</h2>

<p>This software is licensed under <a href="LICENSE" target="_blank">MIT License</a>.</p>

<p><a href="https://opensource.org/licenses/MIT" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Opensource.svg/100px-Opensource.svg.png" alt="Open Source Initiative"/></a></p>
</div>
</body>
</html>
